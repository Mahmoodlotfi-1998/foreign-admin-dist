import{T as F,u as D,c as z}from"./confirmModal-B4zB7pDH.js";import{r as Y}from"./useDataTime-DOvR3mNh.js";import{ao as j,d as N,b as i,r as C,o as A,a9 as T,p as s,w as r,ax as L,u as g,c as H,a as y,a5 as K,a8 as $,j as q,ak as B,z as G,am as J,F as Q,an as E,as as W}from"./index-D3f-eotr.js";import{u as O,_ as P,F as X}from"./usePrice-DMB-akCl.js";import{_ as V,d as Z}from"./BasicSelect.vue_vue_type_style_index_0_lang-C3nCD8O3.js";import{B as ee}from"./BasicMainCard-CX2Z74CP.js";import{_ as te}from"./BasicTextArea.vue_vue_type_style_index_0_lang-zZ8iABL4.js";import{i as S}from"./inputRules-DJIDSJQX.js";import{h as U}from"./axios-Bh6uyqao.js";import"./Col-BhssJo_S.js";const ae=async l=>j.fetch("pre_applications","insert",{data:l}),le=async l=>U.post("/send-emails",l),oe=async l=>U.post("/send-sms",l),se=[{title:"Rows",dataIndex:"id",key:"id",filterable:!1,sortable:!1,width:100,customRender:l=>l.index+1},{title:"Type offer",dataIndex:"type_offer",key:"type_offer",type:"Number",width:100},{title:"Date and time",dataIndex:"created_at",key:"created_at",type:"DateTime",width:200,customRender(l){return Y(l.record.created_at)}},{title:"Text",dataIndex:"message",key:"message",type:"Number"}],ne=N({__name:"table",props:{mobile:{}},emits:["delete","edit","add","info"],setup(l,{expose:a,emit:k}){const[f,b]=D(),v=k;i(null);const h=i({columns:se,api:m=>F(m,"pre_applications")});return a({fetch:()=>{b()}}),(m,n)=>{const p=C("BaseIcon"),c=C("BaseButton"),R=C("BaseTable"),I=C("BasicShowContext");return A(),T("div",null,[s(I,{title:"Offers list"},{default:r(()=>[s(R,L(g(h),{onRegister:g(f),ref:"tbl"}),{extraHeader:r(()=>[m.mobile?K("",!0):(A(),H(c,{key:0,type:"primary",size:"small",class:"flex",onClick:n[0]||(n[0]=e=>v("add"))},{default:r(()=>[n[1]||(n[1]=y("div",null,"Send Offer",-1)),s(p,{icon:"vuesax-linear:sms",Size:"16px"})]),_:1}))]),action:r(({column:e,record:t})=>n[2]||(n[2]=[])),_:1},16,["onRegister"])]),_:1})])}}}),re=[{title:"Rows",dataIndex:"id",key:"id",filterable:!1,sortable:!1,width:70,customRender:l=>l.index+1},{title:"Owner Name",dataIndex:"owner_name_formatted",key:"owner_name_formatted",type:"Text",width:140},{title:"Phone number",dataIndex:"phone_number",key:"phone_number",type:"Number",width:120,customRender(l){var a;return"+"+((a=l.record)==null?void 0:a.phone_number)}},{title:"Current LTV",dataIndex:"current_ltv",key:"current_ltv",type:"Number",width:90,customRender(l){var a;return((a=l.record)==null?void 0:a.current_ltv)??"- %"}},{title:"1st Mortgage Interest Rate",dataIndex:"first_mortgage_interest_rate",key:"first_mortgage_interest_rate",type:"Number",width:120,customRender(l){var a;return((a=l.record)==null?void 0:a.first_mortgage_interest_rate)??"- %"}},{title:"Age",dataIndex:"age",key:"age",type:"Number",width:60},{title:"1st Mortgage Loan Amount",dataIndex:"first_mortgage_loan_amount",key:"first_mortgage_loan_amount",type:"Number",width:120,customRender(l){var a;return O(((a=l.record)==null?void 0:a.first_mortgage_loan_amount)??0)}},{title:"2nd Mortgage Loan Amount",dataIndex:"second_mortgage_loan_amount",key:"second_mortgage_loan_amount",type:"Number",width:130,customRender(l){var a;return O(((a=l.record)==null?void 0:a.second_mortgage_loan_amount)??0)}},{title:"Current Year Tax Amount",dataIndex:"current_year_tax_amount",key:"current_year_tax_amount",type:"Number",width:120},{title:"Owner Occupied",dataIndex:"owner_occupied_residential",key:"owner_occupied_residential",type:"Boolean",width:100,customRender(l){var a;return(a=l.record)!=null&&a.owner_occupied_residential?"Yes":"No"}},{title:"Sale Recording Date",dataIndex:"sale_recording_date",key:"sale_recording_date",type:"Number",width:130}],ue={class:"gap-2 hidden md:flex justify-center"},ie=N({__name:"customersTable",emits:["delete","edit","add","info","chargeMoney","update:items"],setup(l,{expose:a,emit:k}){const[f,b]=D(),v=k,h=[{value:"Current LTV Above 50",key:"current_ltv_above_50"},{value:"SR Date Above And FMLA",key:"sr_date_above_and_fmla"},{value:"Owner Occupied Residential No",key:"owner_occupied_residential_no"},{value:"Current Tax Year Above 20000",key:"current_tax_year_above20000"},{value:"FMLA Above 1 And SMLA Above 1",key:"fmla_above1_and_smla_above1"},{value:"Age Above 55",key:"age_above_55"},{value:"First Mortgage Interest Rate Above 65",key:"first_mortgage_interest_rate_above_65"},{value:"Current LTV Above 80",key:"current_ltv_above_80"},{value:"Complete Profile",key:"complete_profile"}];i(null);const o=i([]);function m(e){z("user",e.user_id,Z,b)}const n=i([]),p=i(void 0);let c=!1;const R=i({columns:re,api:async e=>{var u,w;c&&(e.filters=[],o.value.forEach(d=>{var x;(x=e.filters)==null||x.push({field:d,type:"switch",value:!0,cr:"and",op:"eq",hidden:!0})})),e.filters||(e.filters=[]),c=!1;const t=$.isEqual(e==null?void 0:e.filters,(u=p.value)==null?void 0:u.filters),_=$.isEqual(e==null?void 0:e.search,(w=p.value)==null?void 0:w.search);return(!t||!_)&&(n.value=[]),p.value=e,await F(e,"borrowers")},rowSelection:{selectedRowKeys:n,onSelect:(e,t,_,u)=>{n.value.includes(e.id)?n.value.splice(n.value.indexOf(e.id),1):n.value.push(e.id),v("items",n.value)},onSelectAll:(e,t,_)=>{e?n.value.push(...t.filter(u=>u==null?void 0:u.id).map(u=>u.id)):_.map(u=>{n.value.includes(u.id)&&n.value.splice(n.value.indexOf(u.id),1)}),v("update:items",n.value)}}});i(),i(!1);const I=()=>{b()};return q(o,e=>{c=!0,b()}),a({fetch:I}),(e,t)=>{const _=P,u=G,w=C("BaseTable");return A(),T("div",null,[s(w,L(R.value,{onRegister:g(f),ref:"tbl",height:"30vh"}),{extraHeader:r(()=>[s(_,{label:"Select condition",class:"w-30rem"},{default:r(()=>[s(V,{value:o.value,"onUpdate:value":t[0]||(t[0]=d=>o.value=d),items:h,valueName:"value","show-search":!1,keyName:"key",mode:"multiple",class:"w-full"},null,8,["value"])]),_:1})]),action:r(({column:d,record:x})=>[y("div",ue,[s(u,{placement:"bottom",class:"cursor-pointer",onClick:M=>v("info",x)},{title:r(()=>t[1]||(t[1]=[y("span",null,"Details",-1)])),default:r(()=>[s(B,{icon:"vuesax-linear:stickynote",color:"#10913A"})]),_:2},1032,["onClick"]),s(u,{placement:"bottom",class:"cursor-pointer",onClick:M=>v("edit",x)},{title:r(()=>t[2]||(t[2]=[y("span",null,"Edit",-1)])),default:r(()=>[s(B,{icon:"vuesax-linear:edit",color:"#4572E9"})]),_:2},1032,["onClick"]),s(u,{placement:"bottom",class:"cursor-pointer",onClick:M=>m(x)},{title:r(()=>t[3]||(t[3]=[y("span",null,"Delete",-1)])),default:r(()=>[s(B,{icon:"vuesax-linear:trash",color:"#EB3535"})]),_:2},1032,["onClick"])])]),_:1},16,["onRegister"])])}}}),de={class:"flex w-full h-full"},xe=N({__name:"index",setup(l){const a=i(!1),k=[{value:"Email"},{value:"SMS"}],f=i(null),b=i(null),v=()=>{var e;return(e=f==null?void 0:f.value)==null?void 0:e.fetch()};i(1);let h=i(0);const o=i({borrower_ids:[],message:"",type_offer:void 0,send_username_login:!1}),m=i();q(o.value.borrower_ids,e=>{console.log(e)});async function n(){a.value=!0,c.value=!0,h.value++,p(),a.value=!1}const p=()=>{var e;(e=m.value)==null||e.resetFields(),o.value={borrower_ids:[],message:"",type_offer:void 0,send_username_login:!1}},c=i(!1);function R(e){o.value.borrower_ids=e,console.log(o.value.borrower_ids)}function I(){var e;(e=m.value)==null||e.validateFields().then(async()=>{try{if(a.value=!0,o.value.borrower_ids===[]){E.error("Please select at least one user");return}if(await ae(o.value),o.value.type_offer==="SMS"){const t=await oe({to:o.value.borrower_ids,text:o.value.message});console.log("res ===>",t)}else{const t=await le({to:o.value.borrower_ids,text:o.value.message});console.log("res ===>",t)}p(),v(),c.value=!1,E.success("Request send successfully.")}catch(t){console.log(t)}finally{a.value=!1}})}return(e,t)=>{const _=P,u=W,w=X;return A(),T(Q,null,[y("div",null,[s(ee,null,{default:r(()=>[y("div",de,[s(ne,{ref_key:"table",ref:f,class:"w-full h-full",onAdd:n},null,512)])]),_:1})]),s(J,{visible:c.value,"onUpdate:visible":t[3]||(t[3]=d=>c.value=d),width:"90vw",title:"",onOk:I,loading:a.value,onClose:t[4]||(t[4]=d=>c.value=!1)},{default:r(()=>[s(w,{model:o.value,ref_key:"formRef",ref:m,autocomplete:"off",class:"md:grid md:grid-cols-4 gap-4"},{default:r(()=>[s(_,{label:"Select send type",name:"type_offer",rules:g(S)()},{default:r(()=>[s(V,{value:o.value.type_offer,"onUpdate:value":t[0]||(t[0]=d=>o.value.type_offer=d),items:k,valueName:"value",keyName:"value",class:"w-full"},null,8,["value"])]),_:1},8,["rules"]),s(_,{label:"Send user information",name:"send_username_login",rules:g(S)()},{default:r(()=>[s(u,{checked:o.value.send_username_login,"onUpdate:checked":t[1]||(t[1]=d=>o.value.send_username_login=d)},null,8,["checked"])]),_:1},8,["rules"]),s(_,{label:"Message",name:"message",class:"md:col-span-4",rules:g(S)()},{default:r(()=>[s(te,{value:o.value.message,"onUpdate:value":t[2]||(t[2]=d=>o.value.message=d)},null,8,["value"])]),_:1},8,["rules"]),s(_,{label:"Select user(s)",class:"md:col-span-4",rules:g(S)()},{default:r(()=>[s(ie,{ref_key:"tableCustomer",ref:b,class:"w-full h-full",onItems:R},null,512)]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["visible","loading"])],64)}}});export{xe as default};
