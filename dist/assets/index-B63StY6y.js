import{d as R,b as t,ak as G,j as k,o as h,aa as V,p as s,w as a,a as r,a7 as w,ay as H,u as p,am as x,c as O,az as C,a5 as W,a6 as J,aw as K,a9 as L,z as Q,aA as X,aB as Y,aq as Z,k as ee,aC as te}from"./index-DSlaLO5m.js";import{_ as se}from"./UserField.vue_vue_type_script_setup_true_lang-Bhyr_1Ts.js";import{T as ae,u as le,b as oe}from"./confirmModal-eL3Kn6rd.js";import{r as ne}from"./useDataTime-Bw-ruvr2.js";import{C as ie,g as re,c as ue}from"./chat-C18MpFw3.js";import{B as de}from"./BasicMainCard-CO1QsIBO.js";import"./axios-DyC__b6G.js";import"./index-BdhlOcxZ.js";import"./Col-D3WaeiCg.js";import"./BasicTextArea.vue_vue_type_style_index_0_lang-BG1djzEv.js";const fe=[{title:"Rows",dataIndex:"id",key:"id",filterable:!1,sortable:!1,width:100,customRender:f=>f.index+1},{title:"Date and time",dataIndex:"created_at",key:"created_at",type:"DateTime",width:130,customRender(f){return ne(f.record.created_at)}},{title:"Type",dataIndex:"type",key:"type",type:"Text",width:120},{title:"Message",dataIndex:"message",key:"message",type:"Text",width:300}],me={class:"gap-8 flex justify-center"},ce={class:"flex justify-between text-lg"},pe={class:"font-bold"},ve=R({__name:"table",props:{mobile:{}},emits:["delete","edit","add","info"],setup(f,{expose:m,emit:B}){const[v,d]=le(),i=t([]),u=t(),c=t(),I=t(""),_=t();async function D(l){var e;I.value=(e=(await re(l)).data[0])==null?void 0:e.id,u.value=!0}function M(l){oe("Are you sure to finish call?",l??"",ue,P)}function P(){c.value=!1,d()}async function E(l){_.value=l,c.value=!0}t(null);const T=t(),b=t(!1),U=G(),j=t({columns:fe,api:l=>ae(l,"notifications")}),q=()=>{d()};function F(l){console.log(l),T.value=L.cloneDeep(l),b.value=!0}return k(i,l=>{d()}),k(()=>U.refreshTable,l=>{console.log("nemidanam triggered. New refreshTable value:",l),d()}),m({fetch:q}),(l,e)=>{const g=Q,$=X,S=Y,z=se,A=Z;return h(),V("div",null,[s(S,H(j.value,{onRegister:p(v),ref:"tbl"}),{extraHeader:a(()=>e[6]||(e[6]=[])),action:a(({column:n,record:o})=>[r("div",me,[s(g,{placement:"bottom",class:"cursor-pointer",onClick:y=>F(o==null?void 0:o.borrowers)},{title:a(()=>e[7]||(e[7]=[r("span",null,"Info",-1)])),default:a(()=>[s(w,{icon:"vuesax-linear:personalcard",color:"blue"})]),_:2},1032,["onClick"]),s(g,{placement:"bottom",class:"cursor-pointer",onClick:y=>E(o)},{title:a(()=>e[8]||(e[8]=[r("span",null,"Call",-1)])),default:a(()=>[s($,{dot:o==null?void 0:o.call_request},{default:a(()=>[s(w,{icon:"vuesax-linear:call",color:"green"})]),_:2},1032,["dot"])]),_:2},1032,["onClick"]),s(g,{placement:"bottom",class:"cursor-pointer",onClick:y=>D(o==null?void 0:o.id)},{title:a(()=>e[9]||(e[9]=[r("span",null,"Chat",-1)])),default:a(()=>[s($,{dot:!0},{default:a(()=>[s(w,{icon:"vuesax-linear:message",color:"orange"})]),_:1})]),_:2},1032,["onClick"])])]),_:1},16,["onRegister"]),s(x,{visible:b.value,width:"70rem",height:"90rem",title:"Borrower details","custom-footer":!0,onClose:e[0]||(e[0]=n=>b.value=!1),destroyOnClose:!0},{default:a(()=>[s(z,{"user-form":T.value},null,8,["user-form"])]),_:1},8,["visible"]),s(x,{visible:u.value,"onUpdate:visible":e[1]||(e[1]=n=>u.value=n),width:"30rem",title:"Messages","custom-footer":"",loading:p(C),onClose:e[2]||(e[2]=n=>u.value=!1)},{default:a(()=>[u.value?(h(),O(ie,{key:0,id:I.value,loading:p(C)},null,8,["id","loading"])):W("",!0)]),_:1},8,["visible","loading"]),s(x,{visible:c.value,"onUpdate:visible":e[4]||(e[4]=n=>c.value=n),width:"20rem",title:"Phone","custom-footer":"",loading:p(C),onClose:e[5]||(e[5]=n=>u.value=!1)},{default:a(()=>{var n,o;return[r("div",ce,[e[10]||(e[10]=r("div",null,"Phone:",-1)),r("div",pe,J((o=(n=_.value)==null?void 0:n.borrowers)==null?void 0:o.phone_number),1)]),s(A,{class:"mt-5 w-full",type:"primary",onClick:e[3]||(e[3]=y=>{var N;return M((N=_.value)==null?void 0:N.id)})},{default:a(()=>e[11]||(e[11]=[K("I have been called ")])),_:1})]}),_:1},8,["visible","loading"])])}}}),_e={class:"flex w-full h-full"},Te=R({__name:"index",setup(f){const m=t(!1);t([]),ee(()=>{te.channel("realtime:notification").on("postgres_changes",{event:"INSERT",schema:"public",table:"notification"},i=>{console.log("New insert:",i.new)}).subscribe(),B()});async function B(){try{m.value=!0}catch(i){console.log(i)}finally{m.value=!1}}const v=t(null);t(null),t(0);const d=t({borrower_ids:[],message:"",type_offer:void 0,send_username_login:!1});return t(),k(d.value.borrower_ids,i=>{console.log(i)}),t(!1),(i,u)=>(h(),V("div",null,[s(de,null,{default:a(()=>[r("div",_e,[s(ve,{ref_key:"table",ref:v,class:"w-full h-full"},null,512)])]),_:1})]))}});export{Te as default};
