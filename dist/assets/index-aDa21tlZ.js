import{T as H,u as O,b as W}from"./confirmModal-B4zB7pDH.js";import{d as V,b as t,aj as J,j as h,r as w,o as B,a9 as D,p as s,w as l,a as r,ak as x,ax as K,u as p,am as C,c as L,ay as k,a5 as Q,a6 as X,av as Y,a8 as Z,z as ee,az as te,k as se,aA as le}from"./index-D3f-eotr.js";import{r as ae}from"./useDataTime-DOvR3mNh.js";import{C as oe,g as ne,c as ie}from"./chat-v6ouFI4k.js";import{B as re}from"./BasicMainCard-CX2Z74CP.js";import"./axios-Bh6uyqao.js";import"./BasicTextArea.vue_vue_type_style_index_0_lang-zZ8iABL4.js";import"./Col-BhssJo_S.js";const ue=[{title:"Rows",dataIndex:"id",key:"id",filterable:!1,sortable:!1,width:100,customRender:f=>f.index+1},{title:"Date and time",dataIndex:"created_at",key:"created_at",type:"DateTime",width:130,customRender(f){return ae(f.record.created_at)}},{title:"Type",dataIndex:"type",key:"type",type:"Text",width:120},{title:"Message",dataIndex:"message",key:"message",type:"Text",width:300}],de={class:"gap-8 flex justify-center"},fe={class:"flex justify-between text-lg"},me={class:"font-bold"},ce=V({__name:"table",props:{mobile:{}},emits:["delete","edit","add","info"],setup(f,{expose:m,emit:T}){const[v,d]=O(),i=t([]),u=t(),c=t(),I=t(""),b=t();async function M(a){var e;I.value=(e=(await ne(a)).data[0])==null?void 0:e.id,u.value=!0}function P(a){W("Are you sure to finish call?",a??"",ie,U)}function U(){c.value=!1,d()}async function j(a){b.value=a,c.value=!0}t(null);const $=t(),g=t(!1),E=J(),F=t({columns:ue,api:a=>H(a,"notifications")}),S=()=>{d()};function q(a){console.log(a),$.value=Z.cloneDeep(a),g.value=!0}return h(i,a=>{d()}),h(()=>E.refreshTable,a=>{console.log("nemidanam triggered. New refreshTable value:",a),d()}),m({fetch:S}),(a,e)=>{const _=ee,N=te,z=w("BaseTable"),A=w("UserField"),G=w("BaseButton");return B(),D("div",null,[s(z,K(F.value,{onRegister:p(v),ref:"tbl"}),{extraHeader:l(()=>e[6]||(e[6]=[])),action:l(({column:n,record:o})=>[r("div",de,[s(_,{placement:"bottom",class:"cursor-pointer",onClick:y=>q(o==null?void 0:o.borrowers)},{title:l(()=>e[7]||(e[7]=[r("span",null,"Info",-1)])),default:l(()=>[s(x,{icon:"vuesax-linear:personalcard",color:"blue"})]),_:2},1032,["onClick"]),s(_,{placement:"bottom",class:"cursor-pointer",onClick:y=>j(o)},{title:l(()=>e[8]||(e[8]=[r("span",null,"Call",-1)])),default:l(()=>[s(N,{dot:o==null?void 0:o.call_request},{default:l(()=>[s(x,{icon:"vuesax-linear:call",color:"green"})]),_:2},1032,["dot"])]),_:2},1032,["onClick"]),s(_,{placement:"bottom",class:"cursor-pointer",onClick:y=>M(o==null?void 0:o.id)},{title:l(()=>e[9]||(e[9]=[r("span",null,"Chat",-1)])),default:l(()=>[s(N,{dot:!0},{default:l(()=>[s(x,{icon:"vuesax-linear:message",color:"orange"})]),_:1})]),_:2},1032,["onClick"])])]),_:1},16,["onRegister"]),s(C,{visible:g.value,width:"70rem",height:"90rem",title:"Borrower details","custom-footer":!0,onClose:e[0]||(e[0]=n=>g.value=!1),destroyOnClose:!0},{default:l(()=>[s(A,{"user-form":$.value},null,8,["user-form"])]),_:1},8,["visible"]),s(C,{visible:u.value,"onUpdate:visible":e[1]||(e[1]=n=>u.value=n),width:"30rem",title:"Messages","custom-footer":"",loading:p(k),onClose:e[2]||(e[2]=n=>u.value=!1)},{default:l(()=>[u.value?(B(),L(oe,{key:0,id:I.value,loading:p(k)},null,8,["id","loading"])):Q("",!0)]),_:1},8,["visible","loading"]),s(C,{visible:c.value,"onUpdate:visible":e[4]||(e[4]=n=>c.value=n),width:"20rem",title:"Phone","custom-footer":"",loading:p(k),onClose:e[5]||(e[5]=n=>u.value=!1)},{default:l(()=>{var n,o;return[r("div",fe,[e[10]||(e[10]=r("div",null,"Phone:",-1)),r("div",me,X((o=(n=b.value)==null?void 0:n.borrowers)==null?void 0:o.phone_number),1)]),s(G,{class:"mt-5 w-full",type:"primary",onClick:e[3]||(e[3]=y=>{var R;return P((R=b.value)==null?void 0:R.id)})},{default:l(()=>e[11]||(e[11]=[Y("I have been called ")])),_:1})]}),_:1},8,["visible","loading"])])}}}),pe={class:"flex w-full h-full"},ke=V({__name:"index",setup(f){const m=t(!1);t([]),se(()=>{le.channel("realtime:notification").on("postgres_changes",{event:"INSERT",schema:"public",table:"notification"},i=>{console.log("New insert:",i.new)}).subscribe(),T()});async function T(){try{m.value=!0}catch(i){console.log(i)}finally{m.value=!1}}const v=t(null);t(null),t(0);const d=t({borrower_ids:[],message:"",type_offer:void 0,send_username_login:!1});return t(),h(d.value.borrower_ids,i=>{console.log(i)}),t(!1),(i,u)=>(B(),D("div",null,[s(re,null,{default:l(()=>[r("div",pe,[s(ce,{ref_key:"table",ref:v,class:"w-full h-full"},null,512)])]),_:1})]))}});export{ke as default};
