import{ao as z,d as N,b as u,r as Y,o as A,aa as B,p as o,w as r,ay as O,u as y,c as j,a as b,a5 as H,a7 as S,aq as K,aB as F,a9 as $,j as D,z as G,am as J,F as Q,an as M,at as W}from"./index-DzwtkiX2.js";import{T as q,u as L,c as X}from"./confirmModal-D1G569GL.js";import{r as Z}from"./useDataTime-Bw-ruvr2.js";import{u as E}from"./usePrice-yLsZ7WwN.js";import{_ as P,d as ee}from"./BasicSelect.vue_vue_type_style_index_0_lang-D0yusZOD.js";import{_ as V,F as te}from"./index-BqVR2KHs.js";import{B as ae}from"./BasicMainCard-DH9qsHzW.js";import{_ as le}from"./BasicTextArea.vue_vue_type_style_index_0_lang-Cl3CBFCf.js";import{i as C}from"./inputRules-DD_CTgd6.js";import{h as U}from"./axios-BdcwW8xT.js";import"./Col-BJRJG_13.js";const oe=async l=>z.fetch("pre_applications","insert",{data:l}),se=async l=>U.post("/send-emails",{list:l}),ne=async l=>U.post("/send-sms",{list:l}),re=[{title:"Rows",dataIndex:"id",key:"id",filterable:!1,sortable:!1,width:100,customRender:l=>l.index+1},{title:"Type offer",dataIndex:"type_offer",key:"type_offer",type:"Number",width:100},{title:"Date and time",dataIndex:"created_at",key:"created_at",type:"DateTime",width:200,customRender(l){return Z(l.record.created_at)}},{title:"Text",dataIndex:"message",key:"message",type:"Number"}],ie=N({__name:"table",props:{mobile:{}},emits:["delete","edit","add","info"],setup(l,{expose:a,emit:x}){const[f,g]=L(),p=x;u(null);const h=u({columns:re,api:m=>q(m,"pre_applications")});return a({fetch:()=>{g()}}),(m,n)=>{const v=S,c=K,R=F,I=Y("BasicShowContext");return A(),B("div",null,[o(I,{title:"Offers list"},{default:r(()=>[o(R,O(y(h),{onRegister:y(f),ref:"tbl"}),{extraHeader:r(()=>[m.mobile?H("",!0):(A(),j(c,{key:0,type:"primary",size:"small",class:"flex",onClick:n[0]||(n[0]=e=>p("add"))},{default:r(()=>[n[1]||(n[1]=b("div",null,"Send Offer",-1)),o(v,{icon:"vuesax-linear:sms",Size:"16px"})]),_:1}))]),action:r(({column:e,record:t})=>n[2]||(n[2]=[])),_:1},16,["onRegister"])]),_:1})])}}}),ue=[{title:"Rows",dataIndex:"id",key:"id",filterable:!1,sortable:!1,width:70,customRender:l=>l.index+1},{title:"Owner Name",dataIndex:"owner_name_formatted",key:"owner_name_formatted",type:"Text",width:140},{title:"Phone number",dataIndex:"phone_number",key:"phone_number",type:"Number",width:120,customRender(l){var a;return"+"+((a=l.record)==null?void 0:a.phone_number)}},{title:"Current LTV",dataIndex:"current_ltv",key:"current_ltv",type:"Number",width:90,customRender(l){var a;return((a=l.record)==null?void 0:a.current_ltv)??"- %"}},{title:"1st Mortgage Interest Rate",dataIndex:"first_mortgage_interest_rate",key:"first_mortgage_interest_rate",type:"Number",width:120,customRender(l){var a;return((a=l.record)==null?void 0:a.first_mortgage_interest_rate)??"- %"}},{title:"Age",dataIndex:"age",key:"age",type:"Number",width:60},{title:"1st Mortgage Loan Amount",dataIndex:"first_mortgage_loan_amount",key:"first_mortgage_loan_amount",type:"Number",width:120,customRender(l){var a;return E(((a=l.record)==null?void 0:a.first_mortgage_loan_amount)??0)}},{title:"2nd Mortgage Loan Amount",dataIndex:"second_mortgage_loan_amount",key:"second_mortgage_loan_amount",type:"Number",width:130,customRender(l){var a;return E(((a=l.record)==null?void 0:a.second_mortgage_loan_amount)??0)}},{title:"Current Year Tax Amount",dataIndex:"current_year_tax_amount",key:"current_year_tax_amount",type:"Number",width:120},{title:"Owner Occupied",dataIndex:"owner_occupied_residential",key:"owner_occupied_residential",type:"Boolean",width:100,customRender(l){var a;return(a=l.record)!=null&&a.owner_occupied_residential?"Yes":"No"}},{title:"Sale Recording Date",dataIndex:"sale_recording_date",key:"sale_recording_date",type:"Number",width:130}],de={class:"gap-2 hidden md:flex justify-center"},ce=N({__name:"customersTable",emits:["delete","edit","add","info","chargeMoney","update:items"],setup(l,{expose:a,emit:x}){const[f,g]=L(),p=x,h=[{value:"Current LTV Above 50",key:"current_ltv_above_50"},{value:"SR Date Above And FMLA",key:"sr_date_above_and_fmla"},{value:"Owner Occupied Residential No",key:"owner_occupied_residential_no"},{value:"Current Tax Year Above 20000",key:"current_tax_year_above20000"},{value:"FMLA Above 1 And SMLA Above 1",key:"fmla_above1_and_smla_above1"},{value:"Age Above 55",key:"age_above_55"},{value:"First Mortgage Interest Rate Above 65",key:"first_mortgage_interest_rate_above_65"},{value:"Current LTV Above 80",key:"current_ltv_above_80"},{value:"Complete Profile",key:"complete_profile"}];u(null);const s=u([]);function m(e){X("user",e.user_id,ee,g)}const n=u([]),v=u(void 0);let c=!1;const R=u({columns:ue,api:async e=>{var i,w;c&&(e.filters=[],s.value.forEach(d=>{var k;(k=e.filters)==null||k.push({field:d,type:"switch",value:!0,cr:"and",op:"eq",hidden:!0})})),e.filters||(e.filters=[]),c=!1;const t=$.isEqual(e==null?void 0:e.filters,(i=v.value)==null?void 0:i.filters),_=$.isEqual(e==null?void 0:e.search,(w=v.value)==null?void 0:w.search);return(!t||!_)&&(n.value=[]),v.value=e,await q(e,"borrowers")},rowSelection:{selectedRowKeys:n,onSelect:(e,t,_,i)=>{n.value.includes(e.id)?n.value.splice(n.value.indexOf(e.id),1):n.value.push(e.id),p("items",n.value)},onSelectAll:(e,t,_)=>{e?n.value.push(...t.filter(i=>i==null?void 0:i.id).map(i=>i.id)):_.map(i=>{n.value.includes(i.id)&&n.value.splice(n.value.indexOf(i.id),1)}),p("update:items",n.value)}}});u(),u(!1);const I=()=>{g()};return D(s,e=>{c=!0,g()}),a({fetch:I}),(e,t)=>{const _=V,i=G,w=F;return A(),B("div",null,[o(w,O(R.value,{onRegister:y(f),ref:"tbl",height:"30vh"}),{extraHeader:r(()=>[o(_,{label:"Select condition",class:"w-30rem"},{default:r(()=>[o(P,{value:s.value,"onUpdate:value":t[0]||(t[0]=d=>s.value=d),items:h,valueName:"value","show-search":!1,keyName:"key",mode:"multiple",class:"w-full"},null,8,["value"])]),_:1})]),action:r(({column:d,record:k})=>[b("div",de,[o(i,{placement:"bottom",class:"cursor-pointer",onClick:T=>p("info",k)},{title:r(()=>t[1]||(t[1]=[b("span",null,"Details",-1)])),default:r(()=>[o(S,{icon:"vuesax-linear:stickynote",color:"#10913A"})]),_:2},1032,["onClick"]),o(i,{placement:"bottom",class:"cursor-pointer",onClick:T=>p("edit",k)},{title:r(()=>t[2]||(t[2]=[b("span",null,"Edit",-1)])),default:r(()=>[o(S,{icon:"vuesax-linear:edit",color:"#4572E9"})]),_:2},1032,["onClick"]),o(i,{placement:"bottom",class:"cursor-pointer",onClick:T=>m(k)},{title:r(()=>t[3]||(t[3]=[b("span",null,"Delete",-1)])),default:r(()=>[o(S,{icon:"vuesax-linear:trash",color:"#EB3535"})]),_:2},1032,["onClick"])])]),_:1},16,["onRegister"])])}}}),_e={class:"flex w-full h-full"},Re=N({__name:"index",setup(l){const a=u(!1),x=[{value:"Email"},{value:"SMS"}],f=u(null),g=u(null),p=()=>{var e;return(e=f==null?void 0:f.value)==null?void 0:e.fetch()};u(1);let h=u(0);const s=u({borrower_ids:[],message:"",type_offer:void 0,send_username_login:!1}),m=u();D(s.value.borrower_ids,e=>{console.log(e)});async function n(){a.value=!0,c.value=!0,h.value++,v(),a.value=!1}const v=()=>{var e;(e=m.value)==null||e.resetFields(),s.value={borrower_ids:[],message:"",type_offer:void 0,send_username_login:!1}},c=u(!1);function R(e){s.value.borrower_ids=e,console.log(s.value.borrower_ids)}function I(){var e;(e=m.value)==null||e.validateFields().then(async()=>{try{if(a.value=!0,s.value.borrower_ids===[]){M.error("Please select at least one user");return}if(await oe(s.value),s.value.type_offer==="SMS"){const t=await ne(s.value.borrower_ids);console.log("res ===>",t)}else{const t=await se(s.value.borrower_ids);console.log("res ===>",t)}v(),p(),c.value=!1,M.success("Request send successfully.")}catch(t){console.log(t)}finally{a.value=!1}})}return(e,t)=>{const _=V,i=W,w=te;return A(),B(Q,null,[b("div",null,[o(ae,null,{default:r(()=>[b("div",_e,[o(ie,{ref_key:"table",ref:f,class:"w-full h-full",onAdd:n},null,512)])]),_:1})]),o(J,{visible:c.value,"onUpdate:visible":t[3]||(t[3]=d=>c.value=d),width:"90vw",title:"",onOk:I,loading:a.value,onClose:t[4]||(t[4]=d=>c.value=!1)},{default:r(()=>[o(w,{model:s.value,ref_key:"formRef",ref:m,autocomplete:"off",class:"md:grid md:grid-cols-4 gap-4"},{default:r(()=>[o(_,{label:"Select send type",name:"type_offer",rules:y(C)()},{default:r(()=>[o(P,{value:s.value.type_offer,"onUpdate:value":t[0]||(t[0]=d=>s.value.type_offer=d),items:x,valueName:"value",keyName:"value",class:"w-full"},null,8,["value"])]),_:1},8,["rules"]),o(_,{label:"Send user information",name:"send_username_login",rules:y(C)()},{default:r(()=>[o(i,{checked:s.value.send_username_login,"onUpdate:checked":t[1]||(t[1]=d=>s.value.send_username_login=d)},null,8,["checked"])]),_:1},8,["rules"]),o(_,{label:"Message",name:"message",class:"md:col-span-4",rules:y(C)()},{default:r(()=>[o(le,{value:s.value.message,"onUpdate:value":t[2]||(t[2]=d=>s.value.message=d)},null,8,["value"])]),_:1},8,["rules"]),o(_,{label:"Select user(s)",class:"md:col-span-4",rules:y(C)()},{default:r(()=>[o(ce,{ref_key:"tableCustomer",ref:g,class:"w-full h-full",onItems:R},null,512)]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["visible","loading"])],64)}}});export{Re as default};
