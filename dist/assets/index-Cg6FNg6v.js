import{ao as z,d as N,b as i,r as Y,o as A,aa as B,p as s,w as r,ay as O,u as y,c as j,a as b,a5 as H,a7 as S,aq as K,aB as F,a9 as $,j as D,z as G,am as J,F as Q,an as M,at as W}from"./index-DSlaLO5m.js";import{T as q,u as L,c as X}from"./confirmModal-eL3Kn6rd.js";import{r as Z}from"./useDataTime-Bw-ruvr2.js";import{u as E}from"./usePrice-yLsZ7WwN.js";import{_ as P,d as ee}from"./BasicSelect.vue_vue_type_style_index_0_lang-WU07BBTK.js";import{_ as V,F as te}from"./index-BdhlOcxZ.js";import{B as ae}from"./BasicMainCard-CO1QsIBO.js";import{_ as oe}from"./BasicTextArea.vue_vue_type_style_index_0_lang-BG1djzEv.js";import{i as C}from"./inputRules-DhUjJL3s.js";import{h as U}from"./axios-DyC__b6G.js";import"./Col-D3WaeiCg.js";const le=async o=>z.fetch("pre_applications","insert",{data:o}),se=async o=>U.post("/send-emails",o),ne=async o=>U.post("/send-sms",o),re=[{title:"Rows",dataIndex:"id",key:"id",filterable:!1,sortable:!1,width:100,customRender:o=>o.index+1},{title:"Type offer",dataIndex:"type_offer",key:"type_offer",type:"Number",width:100},{title:"Date and time",dataIndex:"created_at",key:"created_at",type:"DateTime",width:200,customRender(o){return Z(o.record.created_at)}},{title:"Text",dataIndex:"message",key:"message",type:"Number"}],ue=N({__name:"table",props:{mobile:{}},emits:["delete","edit","add","info"],setup(o,{expose:a,emit:k}){const[f,g]=L(),v=k;i(null);const h=i({columns:re,api:m=>q(m,"pre_applications")});return a({fetch:()=>{g()}}),(m,n)=>{const p=S,c=K,R=F,I=Y("BasicShowContext");return A(),B("div",null,[s(I,{title:"Offers list"},{default:r(()=>[s(R,O(y(h),{onRegister:y(f),ref:"tbl"}),{extraHeader:r(()=>[m.mobile?H("",!0):(A(),j(c,{key:0,type:"primary",size:"small",class:"flex",onClick:n[0]||(n[0]=e=>v("add"))},{default:r(()=>[n[1]||(n[1]=b("div",null,"Send Offer",-1)),s(p,{icon:"vuesax-linear:sms",Size:"16px"})]),_:1}))]),action:r(({column:e,record:t})=>n[2]||(n[2]=[])),_:1},16,["onRegister"])]),_:1})])}}}),ie=[{title:"Rows",dataIndex:"id",key:"id",filterable:!1,sortable:!1,width:70,customRender:o=>o.index+1},{title:"Owner Name",dataIndex:"owner_name_formatted",key:"owner_name_formatted",type:"Text",width:140},{title:"Phone number",dataIndex:"phone_number",key:"phone_number",type:"Number",width:120,customRender(o){var a;return"+"+((a=o.record)==null?void 0:a.phone_number)}},{title:"Current LTV",dataIndex:"current_ltv",key:"current_ltv",type:"Number",width:90,customRender(o){var a;return((a=o.record)==null?void 0:a.current_ltv)??"- %"}},{title:"1st Mortgage Interest Rate",dataIndex:"first_mortgage_interest_rate",key:"first_mortgage_interest_rate",type:"Number",width:120,customRender(o){var a;return((a=o.record)==null?void 0:a.first_mortgage_interest_rate)??"- %"}},{title:"Age",dataIndex:"age",key:"age",type:"Number",width:60},{title:"1st Mortgage Loan Amount",dataIndex:"first_mortgage_loan_amount",key:"first_mortgage_loan_amount",type:"Number",width:120,customRender(o){var a;return E(((a=o.record)==null?void 0:a.first_mortgage_loan_amount)??0)}},{title:"2nd Mortgage Loan Amount",dataIndex:"second_mortgage_loan_amount",key:"second_mortgage_loan_amount",type:"Number",width:130,customRender(o){var a;return E(((a=o.record)==null?void 0:a.second_mortgage_loan_amount)??0)}},{title:"Current Year Tax Amount",dataIndex:"current_year_tax_amount",key:"current_year_tax_amount",type:"Number",width:120},{title:"Owner Occupied",dataIndex:"owner_occupied_residential",key:"owner_occupied_residential",type:"Boolean",width:100,customRender(o){var a;return(a=o.record)!=null&&a.owner_occupied_residential?"Yes":"No"}},{title:"Sale Recording Date",dataIndex:"sale_recording_date",key:"sale_recording_date",type:"Number",width:130}],de={class:"gap-2 hidden md:flex justify-center"},ce=N({__name:"customersTable",emits:["delete","edit","add","info","chargeMoney","update:items"],setup(o,{expose:a,emit:k}){const[f,g]=L(),v=k,h=[{value:"Current LTV Above 50",key:"current_ltv_above_50"},{value:"SR Date Above And FMLA",key:"sr_date_above_and_fmla"},{value:"Owner Occupied Residential No",key:"owner_occupied_residential_no"},{value:"Current Tax Year Above 20000",key:"current_tax_year_above20000"},{value:"FMLA Above 1 And SMLA Above 1",key:"fmla_above1_and_smla_above1"},{value:"Age Above 55",key:"age_above_55"},{value:"First Mortgage Interest Rate Above 65",key:"first_mortgage_interest_rate_above_65"},{value:"Current LTV Above 80",key:"current_ltv_above_80"},{value:"Complete Profile",key:"complete_profile"}];i(null);const l=i([]);function m(e){X("user",e.user_id,ee,g)}const n=i([]),p=i(void 0);let c=!1;const R=i({columns:ie,api:async e=>{var u,w;c&&(e.filters=[],l.value.forEach(d=>{var x;(x=e.filters)==null||x.push({field:d,type:"switch",value:!0,cr:"and",op:"eq",hidden:!0})})),e.filters||(e.filters=[]),c=!1;const t=$.isEqual(e==null?void 0:e.filters,(u=p.value)==null?void 0:u.filters),_=$.isEqual(e==null?void 0:e.search,(w=p.value)==null?void 0:w.search);return(!t||!_)&&(n.value=[]),p.value=e,await q(e,"borrowers")},rowSelection:{selectedRowKeys:n,onSelect:(e,t,_,u)=>{n.value.includes(e.id)?n.value.splice(n.value.indexOf(e.id),1):n.value.push(e.id),v("items",n.value)},onSelectAll:(e,t,_)=>{e?n.value.push(...t.filter(u=>u==null?void 0:u.id).map(u=>u.id)):_.map(u=>{n.value.includes(u.id)&&n.value.splice(n.value.indexOf(u.id),1)}),v("update:items",n.value)}}});i(),i(!1);const I=()=>{g()};return D(l,e=>{c=!0,g()}),a({fetch:I}),(e,t)=>{const _=V,u=G,w=F;return A(),B("div",null,[s(w,O(R.value,{onRegister:y(f),ref:"tbl",height:"30vh"}),{extraHeader:r(()=>[s(_,{label:"Select condition",class:"w-30rem"},{default:r(()=>[s(P,{value:l.value,"onUpdate:value":t[0]||(t[0]=d=>l.value=d),items:h,valueName:"value","show-search":!1,keyName:"key",mode:"multiple",class:"w-full"},null,8,["value"])]),_:1})]),action:r(({column:d,record:x})=>[b("div",de,[s(u,{placement:"bottom",class:"cursor-pointer",onClick:T=>v("info",x)},{title:r(()=>t[1]||(t[1]=[b("span",null,"Details",-1)])),default:r(()=>[s(S,{icon:"vuesax-linear:stickynote",color:"#10913A"})]),_:2},1032,["onClick"]),s(u,{placement:"bottom",class:"cursor-pointer",onClick:T=>v("edit",x)},{title:r(()=>t[2]||(t[2]=[b("span",null,"Edit",-1)])),default:r(()=>[s(S,{icon:"vuesax-linear:edit",color:"#4572E9"})]),_:2},1032,["onClick"]),s(u,{placement:"bottom",class:"cursor-pointer",onClick:T=>m(x)},{title:r(()=>t[3]||(t[3]=[b("span",null,"Delete",-1)])),default:r(()=>[s(S,{icon:"vuesax-linear:trash",color:"#EB3535"})]),_:2},1032,["onClick"])])]),_:1},16,["onRegister"])])}}}),_e={class:"flex w-full h-full"},Re=N({__name:"index",setup(o){const a=i(!1),k=[{value:"Email"},{value:"SMS"}],f=i(null),g=i(null),v=()=>{var e;return(e=f==null?void 0:f.value)==null?void 0:e.fetch()};i(1);let h=i(0);const l=i({borrower_ids:[],message:"",type_offer:void 0,send_username_login:!1}),m=i();D(l.value.borrower_ids,e=>{console.log(e)});async function n(){a.value=!0,c.value=!0,h.value++,p(),a.value=!1}const p=()=>{var e;(e=m.value)==null||e.resetFields(),l.value={borrower_ids:[],message:"",type_offer:void 0,send_username_login:!1}},c=i(!1);function R(e){l.value.borrower_ids=e,console.log(l.value.borrower_ids)}function I(){var e;(e=m.value)==null||e.validateFields().then(async()=>{try{if(a.value=!0,l.value.borrower_ids===[]){M.error("Please select at least one user");return}if(await le(l.value),l.value.type_offer==="SMS"){const t=await ne({to:l.value.borrower_ids,text:l.value.message});console.log("res ===>",t)}else{const t=await se({to:l.value.borrower_ids,text:l.value.message});console.log("res ===>",t)}p(),v(),c.value=!1,M.success("Request send successfully.")}catch(t){console.log(t)}finally{a.value=!1}})}return(e,t)=>{const _=V,u=W,w=te;return A(),B(Q,null,[b("div",null,[s(ae,null,{default:r(()=>[b("div",_e,[s(ue,{ref_key:"table",ref:f,class:"w-full h-full",onAdd:n},null,512)])]),_:1})]),s(J,{visible:c.value,"onUpdate:visible":t[3]||(t[3]=d=>c.value=d),width:"90vw",title:"",onOk:I,loading:a.value,onClose:t[4]||(t[4]=d=>c.value=!1)},{default:r(()=>[s(w,{model:l.value,ref_key:"formRef",ref:m,autocomplete:"off",class:"md:grid md:grid-cols-4 gap-4"},{default:r(()=>[s(_,{label:"Select send type",name:"type_offer",rules:y(C)()},{default:r(()=>[s(P,{value:l.value.type_offer,"onUpdate:value":t[0]||(t[0]=d=>l.value.type_offer=d),items:k,valueName:"value",keyName:"value",class:"w-full"},null,8,["value"])]),_:1},8,["rules"]),s(_,{label:"Send user information",name:"send_username_login",rules:y(C)()},{default:r(()=>[s(u,{checked:l.value.send_username_login,"onUpdate:checked":t[1]||(t[1]=d=>l.value.send_username_login=d)},null,8,["checked"])]),_:1},8,["rules"]),s(_,{label:"Message",name:"message",class:"md:col-span-4",rules:y(C)()},{default:r(()=>[s(oe,{value:l.value.message,"onUpdate:value":t[2]||(t[2]=d=>l.value.message=d)},null,8,["value"])]),_:1},8,["rules"]),s(_,{label:"Select user(s)",class:"md:col-span-4",rules:y(C)()},{default:r(()=>[s(ce,{ref_key:"tableCustomer",ref:g,class:"w-full h-full",onItems:R},null,512)]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["visible","loading"])],64)}}});export{Re as default};
